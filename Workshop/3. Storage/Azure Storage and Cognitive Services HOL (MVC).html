<!DOCTYPE html>
<html>
<head>
<title>Azure Storage and Cognitive Services HOL (MVC)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
/* GitHub stylesheet for MarkdownPad (http://markdownpad.com) */
/* Author: Nicolas Hery - http://nicolashery.com */
/* Version: b13fe65ca28d2e568c6ed5d7f06581183df8f2ff */
/* Source: https://github.com/nicolahery/markdownpad-github */

/* RESET
=============================================================================*/

html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
}

/* BODY
=============================================================================*/

body {
  font-family: Helvetica, arial, freesans, clean, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: #333;
  background-color: #fff;
  padding: 20px;
  max-width: 960px;
  margin: 0 auto;
}

body>*:first-child {
  margin-top: 0 !important;
}

body>*:last-child {
  margin-bottom: 0 !important;
}

/* BLOCKS
=============================================================================*/

p, blockquote, ul, ol, dl, table, pre {
  margin: 15px 0;
}

/* HEADERS
=============================================================================*/

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
}

h1 tt, h1 code, h2 tt, h2 code, h3 tt, h3 code, h4 tt, h4 code, h5 tt, h5 code, h6 tt, h6 code {
  font-size: inherit;
}

h1 {
  font-size: 28px;
  color: #000;
}

h2 {
  font-size: 24px;
  border-bottom: 1px solid #ccc;
  color: #000;
}

h3 {
  font-size: 18px;
}

h4 {
  font-size: 16px;
}

h5 {
  font-size: 14px;
}

h6 {
  color: #777;
  font-size: 14px;
}

body>h2:first-child, body>h1:first-child, body>h1:first-child+h2, body>h3:first-child, body>h4:first-child, body>h5:first-child, body>h6:first-child {
  margin-top: 0;
  padding-top: 0;
}

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0;
}

h1+p, h2+p, h3+p, h4+p, h5+p, h6+p {
  margin-top: 10px;
}

/* LINKS
=============================================================================*/

a {
  color: #4183C4;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* LISTS
=============================================================================*/

ul, ol {
  padding-left: 30px;
}

ul li > :first-child, 
ol li > :first-child, 
ul li ul:first-of-type, 
ol li ol:first-of-type, 
ul li ol:first-of-type, 
ol li ul:first-of-type {
  margin-top: 0px;
}

ul ul, ul ol, ol ol, ol ul {
  margin-bottom: 0;
}

dl {
  padding: 0;
}

dl dt {
  font-size: 14px;
  font-weight: bold;
  font-style: italic;
  padding: 0;
  margin: 15px 0 5px;
}

dl dt:first-child {
  padding: 0;
}

dl dt>:first-child {
  margin-top: 0px;
}

dl dt>:last-child {
  margin-bottom: 0px;
}

dl dd {
  margin: 0 0 15px;
  padding: 0 15px;
}

dl dd>:first-child {
  margin-top: 0px;
}

dl dd>:last-child {
  margin-bottom: 0px;
}

/* CODE
=============================================================================*/

pre, code, tt {
  font-size: 12px;
  font-family: Consolas, "Liberation Mono", Courier, monospace;
}

code, tt {
  margin: 0 0px;
  padding: 0px 0px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px;
}

pre>code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent;
}

pre {
  background-color: #f8f8f8;
  border: 1px solid #ccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px;
}

pre code, pre tt {
  background-color: transparent;
  border: none;
}

kbd {
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    -moz-border-right-colors: none;
    -moz-border-top-colors: none;
    background-color: #DDDDDD;
    background-image: linear-gradient(#F1F1F1, #DDDDDD);
    background-repeat: repeat-x;
    border-color: #DDDDDD #CCCCCC #CCCCCC #DDDDDD;
    border-image: none;
    border-radius: 2px 2px 2px 2px;
    border-style: solid;
    border-width: 1px;
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    line-height: 10px;
    padding: 1px 4px;
}

/* QUOTES
=============================================================================*/

blockquote {
  border-left: 4px solid #DDD;
  padding: 0 15px;
  color: #777;
}

blockquote>:first-child {
  margin-top: 0px;
}

blockquote>:last-child {
  margin-bottom: 0px;
}

/* HORIZONTAL RULES
=============================================================================*/

hr {
  clear: both;
  margin: 15px 0;
  height: 0px;
  overflow: hidden;
  border: none;
  background: transparent;
  border-bottom: 4px solid #ddd;
  padding: 0;
}

/* TABLES
=============================================================================*/

table th {
  font-weight: bold;
}

table th, table td {
  border: 1px solid #ccc;
  padding: 6px 13px;
}

table tr {
  border-top: 1px solid #ccc;
  background-color: #fff;
}

table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

/* IMAGES
=============================================================================*/

img {
  max-width: 100%
}
</style>
<style type="text/css">
.highlight  { background: #ffffff; }
.highlight .c { color: #999988; font-style: italic } /* Comment */
.highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */
.highlight .k { font-weight: bold } /* Keyword */
.highlight .o { font-weight: bold } /* Operator */
.highlight .cm { color: #999988; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #999999; font-weight: bold } /* Comment.Preproc */
.highlight .c1 { color: #999988; font-style: italic } /* Comment.Single */
.highlight .cs { color: #999999; font-weight: bold; font-style: italic } /* Comment.Special */
.highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.highlight .gd .x { color: #000000; background-color: #ffaaaa } /* Generic.Deleted.Specific */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #aa0000 } /* Generic.Error */
.highlight .gh { color: #999999 } /* Generic.Heading */
.highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.highlight .gi .x { color: #000000; background-color: #aaffaa } /* Generic.Inserted.Specific */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #555555 } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #aaaaaa } /* Generic.Subheading */
.highlight .gt { color: #aa0000 } /* Generic.Traceback */
.highlight .kc { font-weight: bold } /* Keyword.Constant */
.highlight .kd { font-weight: bold } /* Keyword.Declaration */
.highlight .kp { font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #445588; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #009999 } /* Literal.Number */
.highlight .s { color: #d14 } /* Literal.String */
.highlight .na { color: #008080 } /* Name.Attribute */
.highlight .nb { color: #0086B3 } /* Name.Builtin */
.highlight .nc { color: #445588; font-weight: bold } /* Name.Class */
.highlight .no { color: #008080 } /* Name.Constant */
.highlight .ni { color: #800080 } /* Name.Entity */
.highlight .ne { color: #990000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #990000; font-weight: bold } /* Name.Function */
.highlight .nn { color: #555555 } /* Name.Namespace */
.highlight .nt { color: #000080 } /* Name.Tag */
.highlight .nv { color: #008080 } /* Name.Variable */
.highlight .ow { font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #009999 } /* Literal.Number.Float */
.highlight .mh { color: #009999 } /* Literal.Number.Hex */
.highlight .mi { color: #009999 } /* Literal.Number.Integer */
.highlight .mo { color: #009999 } /* Literal.Number.Oct */
.highlight .sb { color: #d14 } /* Literal.String.Backtick */
.highlight .sc { color: #d14 } /* Literal.String.Char */
.highlight .sd { color: #d14 } /* Literal.String.Doc */
.highlight .s2 { color: #d14 } /* Literal.String.Double */
.highlight .se { color: #d14 } /* Literal.String.Escape */
.highlight .sh { color: #d14 } /* Literal.String.Heredoc */
.highlight .si { color: #d14 } /* Literal.String.Interpol */
.highlight .sx { color: #d14 } /* Literal.String.Other */
.highlight .sr { color: #009926 } /* Literal.String.Regex */
.highlight .s1 { color: #d14 } /* Literal.String.Single */
.highlight .ss { color: #990073 } /* Literal.String.Symbol */
.highlight .bp { color: #999999 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #008080 } /* Name.Variable.Class */
.highlight .vg { color: #008080 } /* Name.Variable.Global */
.highlight .vi { color: #008080 } /* Name.Variable.Instance */
.highlight .il { color: #009999 } /* Literal.Number.Integer.Long */
.pl-c {
    color: #969896;
}

.pl-c1,.pl-mdh,.pl-mm,.pl-mp,.pl-mr,.pl-s1 .pl-v,.pl-s3,.pl-sc,.pl-sv {
    color: #0086b3;
}

.pl-e,.pl-en {
    color: #795da3;
}

.pl-s1 .pl-s2,.pl-smi,.pl-smp,.pl-stj,.pl-vo,.pl-vpf {
    color: #333;
}

.pl-ent {
    color: #63a35c;
}

.pl-k,.pl-s,.pl-st {
    color: #a71d5d;
}

.pl-pds,.pl-s1,.pl-s1 .pl-pse .pl-s2,.pl-sr,.pl-sr .pl-cce,.pl-sr .pl-sra,.pl-sr .pl-sre,.pl-src,.pl-v {
    color: #df5000;
}

.pl-id {
    color: #b52a1d;
}

.pl-ii {
    background-color: #b52a1d;
    color: #f8f8f8;
}

.pl-sr .pl-cce {
    color: #63a35c;
    font-weight: bold;
}

.pl-ml {
    color: #693a17;
}

.pl-mh,.pl-mh .pl-en,.pl-ms {
    color: #1d3e81;
    font-weight: bold;
}

.pl-mq {
    color: #008080;
}

.pl-mi {
    color: #333;
    font-style: italic;
}

.pl-mb {
    color: #333;
    font-weight: bold;
}

.pl-md,.pl-mdhf {
    background-color: #ffecec;
    color: #bd2c00;
}

.pl-mdht,.pl-mi1 {
    background-color: #eaffea;
    color: #55a532;
}

.pl-mdr {
    color: #795da3;
    font-weight: bold;
}

.pl-mo {
    color: #1d3e81;
}
.task-list {
padding-left:10px;
margin-bottom:0;
}

.task-list li {
    margin-left: 20px;
}

.task-list-item {
list-style-type:none;
padding-left:10px;
}

.task-list-item label {
font-weight:400;
}

.task-list-item.enabled label {
cursor:pointer;
}

.task-list-item+.task-list-item {
margin-top:3px;
}

.task-list-item-checkbox {
display:inline-block;
margin-left:-20px;
margin-right:3px;
vertical-align:1px;
}
</style>
</head>
<body>
<p><a name="HOLTitle"></a></p>
<h1>Azure Storage and Cognitive Services</h1>
<hr>
<p><a name="Overview"></a></p>
<h2>Overview</h2>
<p>Microsoft Azure Storage is a set of services that allows you to store large volumes of data in a cost-effective manner and in a way that makes the data readily and reliably available to services and applications that consume it. Data committed to Azure Storage can be stored in blobs, tables, queues, or files. <a href="http://azure.microsoft.com/en-us/services/storage/blobs/" rel="nofollow">Azure blobs</a> are ideal for storing images, videos, and other types of data, and are frequently used to provide input to and capture output from other Azure services such as <a href="http://azure.microsoft.com/en-us/services/stream-analytics/" rel="nofollow">Azure Stream Analytics</a>. <a href="http://azure.microsoft.com/en-us/services/storage/tables/" rel="nofollow">Azure tables</a> provide NoSQL storage for semi-structured data. <a href="http://azure.microsoft.com/en-us/services/storage/queues/" rel="nofollow">Azure queues</a> support queued message transfers between applications (or parts of applications) and can be used to make applications more scalable and robust by loosely coupling them together. Finally, <a href="http://azure.microsoft.com/en-us/services/storage/files" rel="nofollow">Azure Files</a> use the Server Message Block (SMB) protocol to share files through the cloud and access storage as network drives.</p>
<p>Data stored in Microsoft Azure Storage can be accessed over HTTP or HTTPS using straightforward REST APIs, or it can be accessed using rich client libraries available for many popular languages and platforms, including .NET, Java, Android, Node.js, PHP, Ruby, and Python. The <a href="https://portal.azure.com" rel="nofollow">Azure Portal</a> includes features for working with Azure Storage, but richer functionality is available from third-party tools, many of which are free and some of which work cross-platform.</p>
<p>In this lab, you will use Visual Studio to write an MVC Web app that accepts images uploaded by users and stores the images in Azure blob storage. You will learn how to read and write blobs in C#, and how to use blob metadata to attach additional information to the blobs you create. You will also get first-hand experience using <a href="https://www.microsoft.com/cognitive-services/" rel="nofollow">Microsoft Cognitive Services</a>, a set of intelligence APIs for building smart applications. Specifically, you'll submit each image uploaded by the user to Cognitive Services' <a href="https://www.microsoft.com/cognitive-services/en-us/computer-vision-api" rel="nofollow">Computer Vision API</a> to generate a caption for the image as well as search metadata describing the contents of the image. And you will discover how easy it is to deploy apps to the cloud using Visual Studio.</p>
<p><a name="Objectives"></a></p>
<h3>Objectives</h3>
<p>In this hands-on lab, you will learn how to:</p>
<ul>
<li>Create a storage account and storage containers using the Azure Portal</li>
<li>Create a Web app in Visual Studio and deploy it to Azure</li>
<li>Read and write blobs and attach metadata to them</li>
<li>Use the Computer Vision API to extract information from images</li>
<li>Use the cross-platform <a href="http://storageexplorer.com/" rel="nofollow">Microsoft Azure Storage Explorer</a> to work with Azure Storage</li>
</ul>
<p><a name="Prerequisites"></a></p>
<h3>Prerequisites</h3>
<p>The following are required to complete this hands-on lab:</p>
<ul>
<li>An active Microsoft Azure subscription. If you don't have one, <a href="http://aka.ms/WATK-FreeTrial" rel="nofollow">sign up for a free trial</a>.</li>
<li><a href="https://www.visualstudio.com/en-us/products/visual-studio-community-vs.aspx" rel="nofollow">Visual Studio 2017 Community edition</a> or higher with the "ASP.NET and web development" and "Azure development" workloads installed</li>
<li><a href="http://storageexplorer.com/" rel="nofollow">Microsoft Azure Storage Explorer</a></li>
</ul>
<p><a name="Resources"></a></p>
<h3>Resources</h3>
<p><a href="https://a4r.blob.core.windows.net/public/cs-storage-resources.zip" rel="nofollow">Click here</a> to download a zip file containing the resources used in this lab. Copy the contents of the zip file into a folder on your hard disk.</p>
<hr>
<p><a name="Exercises"></a></p>
<h2>Exercises</h2>
<p>This hands-on lab includes the following exercises:</p>
<ul>
<li><a href="#Exercise1">Exercise 1: Create a storage account</a></li>
<li><a href="#Exercise2">Exercise 2: Run the Microsoft Azure Storage Explorer</a></li>
<li><a href="#Exercise3">Exercise 3: Create a new Web app in Visual Studio</a></li>
<li><a href="#Exercise4">Exercise 4: Add a lightbox for viewing photos</a></li>
<li><a href="#Exercise5">Exercise 5: Use Cognitive Services to generate metadata</a></li>
<li><a href="#Exercise6">Exercise 6: Add search to the app</a></li>
<li><a href="#Exercise7">Exercise 7: Deploy the app to Azure</a></li>
</ul>
<p>Estimated time to complete this lab: <strong>60</strong> minutes.</p>
<p><a name="Exercise1"></a></p>
<h2>Exercise 1: Create a storage account</h2>
<p>The <a href="https://portal.azure.com" rel="nofollow">Azure Portal</a> allows you to perform basic storage operations such as creating storage accounts, creating containers, uploading and downloading blobs, and managing access keys. In this exercise, you will use the portal to create a storage account. Then you'll create a pair of containers: one to store images uploaded by the user, and another to store image thumbnails generated from the uploaded images.</p>
<ol>
<li>
<p>Open the <a href="https://portal.azure.com" rel="nofollow">Azure Portal</a> in your browser. If you are asked to log in, do so using your Microsoft account.</p>
</li>
<li>
<p>To create a storage account, click <strong>+ New</strong> in the ribbon on the left. Then click <strong>Storage</strong>, followed by <strong>Storage account</strong>.</p>
<p><a href="Images/new-storage-account.png" target="_blank"><img src="Images/new-storage-account.png" alt="Creating a storage account" style="max-width:100%;"></a></p>
<p><em>Creating a storage account</em></p>
</li>
<li>
<p>In the ensuing "Create storage account" blade, enter a name for the new storage account in <strong>Name</strong> field. The name is important, because it forms one part of the URL through which blobs created under this account are accessed.</p>
<blockquote>
<p>Storage account names can be 3 to 24 characters in length and can only contain numbers and lowercase letters. In addition, the name you enter must be unique within Azure. If someone else has chosen the same name, you'll be notified that the name isn't available with a red exclamation mark in the <strong>Name</strong> field.</p>
</blockquote>
<p>Once you have a name that Azure will accept, make sure <strong>Resource manager</strong> is selected as the deployment model and <strong>General purpose</strong> is selected as the account type. Then select <strong>Create new</strong> under <strong>Resource group</strong> and enter "IntellipixResources" as the resource-group name. Select the <strong>Location</strong> nearest you, and finish up by clicking the <strong>Create</strong> button at the bottom of the blade to create the new storage account.</p>
<p><a href="Images/create-storage-account.png" target="_blank"><img src="Images/create-storage-account.png" alt="Specifying parameters for a new storage account" style="max-width:100%;"></a></p>
<p><em>Specifying parameters for a new storage account</em></p>
</li>
<li>
<p>Click <strong>Resource groups</strong> in the ribbon on the left. Then click the "IntellipixResources" resource group.</p>
<p><a href="Images/open-resource-group.png" target="_blank"><img src="Images/open-resource-group.png" alt="Opening the resource group" style="max-width:100%;"></a></p>
<p><em>Opening the resource group</em></p>
</li>
<li>
<p>In the blade that opens for the resource group, click the storage account you just created. If the storage account isn't there yet, you can click <strong>Refresh</strong> at the top of the blade until it appears.</p>
<p><a href="Images/open-storage-account.png" target="_blank"><img src="Images/open-storage-account.png" alt="Opening the new storage account" style="max-width:100%;"></a></p>
<p><em>Opening the new storage account</em></p>
</li>
<li>
<p>In the blade for the storage account, click <strong>Blobs</strong> to view a list of containers associated with this account.</p>
<p><a href="Images/view-containers.png" target="_blank"><img src="Images/view-containers.png" alt="Viewing blob containers" style="max-width:100%;"></a></p>
<p><em>Viewing blob containers</em></p>
</li>
<li>
<p>The storage account currently has no containers. Before you can create a blob, you must create a container to store it in. Click <strong>+ Container</strong> to create a new container. Type "photos" (without quotation marks) into the <strong>Name</strong> field and select <strong>Blob</strong> as the <strong>Public access level</strong>. Then click <strong>OK</strong> to create a container named "photos."</p>
<blockquote>
<p>By default, containers and their contents are private. Selecting <strong>Blob</strong> as the access level makes the blobs in the "photos" container publicly accessible, but doesn't make the container itself public. This is what you want since the images stored in the "photos" container will be linked to from a Web app.</p>
</blockquote>
<p><a href="Images/create-photos-container.png" target="_blank"><img src="Images/create-photos-container.png" alt="Creating a &quot;photos&quot; container" style="max-width:100%;"></a></p>
<p><em>Creating a "photos" container</em></p>
</li>
<li>
<p>Repeat the previous step to create a container named "thumbnails," once more ensuring that the container's <strong>Public access level</strong> is set to <strong>Blob</strong>.</p>
</li>
<li>
<p>Confirm that both containers appear in the list of containers for this storage account, and that the names are spelled correctly.</p>
<p><a href="Images/new-containers.png" target="_blank"><img src="Images/new-containers.png" alt="The new containers" style="max-width:100%;"></a></p>
<p><em>The new containers</em></p>
</li>
<li>
<p>Close the "Blob service" blade. Click <strong>Access keys</strong> in the menu on the left side of the storage-account blade, and then click the <strong>Copy</strong> button next to <strong>KEY</strong> for <strong>key1</strong>. Paste this access key into your favorite text editor for later use.</p>
<p><a href="Images/copy-storage-account-access-key.png" target="_blank"><img src="Images/copy-storage-account-access-key.png" alt="Copying the access key" style="max-width:100%;"></a></p>
<p><em>Copying the access key</em></p>
</li>
</ol>
<p>You have now created a storage account to hold images uploaded to the app you're going to build, and containers to store the images in. Note that you <em>could</em> create these containers from within the app. Whether to create them programmatically or create them as part of the provisioning process is a choice that's left up to app developers.</p>
<p><a name="Exercise2"></a></p>
<h2>Exercise 2: Run the Microsoft Azure Storage Explorer</h2>
<p>The <a href="http://storageexplorer.com/" rel="nofollow">Microsoft Azure Storage Explorer</a> is a free tool that provides a graphical interface for working with Azure Storage on PCs running Windows, macOS, and Linux. It provides most of the same functionality as the Azure Portal. It also offers features the portal does not, such as the ability to view blob metadata. In this exercise, you will use the Microsoft Azure Storage Explorer to view the containers you created in Exercise 1.</p>
<ol>
<li>
<p>If you haven't installed Storage Explorer or would like to make sure you're running the latest version, go to <a href="http://storageexplorer.com/" rel="nofollow">http://storageexplorer.com/</a> and download and install it.</p>
</li>
<li>
<p>Start Storage Explorer. If you are asked to log in, do so using your Microsoft account — the same one that you used to log in to the Azure Portal. If you don't see the storage account created in the previous exercise in Storage Explorer's left pane, click the <strong>Manage Accounts</strong> button highlighted below and ensure that your Microsoft account <em>and</em> the subscription used to create the storage account have been added to Storage Explorer.</p>
<p><a href="Images/add-account.png" target="_blank"><img src="Images/add-account.png" alt="Managing accounts in Storage Explorer" style="max-width:100%;"></a></p>
<p><em>Managing accounts in Storage Explorer</em></p>
</li>
<li>
<p>Click the small arrow next to the storage account you created in Exercise 1 to display its contents, and then click the arrow next to <strong>Blob Containers</strong>. Confirm that the containers you created in Exercise 1 appear in the list.</p>
<p><a href="Images/storage-explorer.png" target="_blank"><img src="Images/storage-explorer.png" alt="Viewing blob containers" style="max-width:100%;"></a></p>
<p><em>Viewing blob containers</em></p>
</li>
</ol>
<p>The containers are currently empty, but that will change once your app is deployed and you start uploading photos. Having Storage Explorer installed will make it easy for you to see what your app writes to blob storage.</p>
<p><a name="Exercise3"></a></p>
<h2>Exercise 3: Create a new Web app in Visual Studio</h2>
<p>In this exercise, you will create a new Web app in Visual Studio and add code to implement the basic functionality required to upload images, write them to blob storage, and display them in a Web page.</p>
<ol>
<li>
<p>Start Visual Studio and use the <strong>File -&gt; New -&gt; Project</strong> command to create a new Visual C# <strong>ASP.NET Web Application</strong> project named "Intellipix" (short for "Intelligent Pictures").</p>
<p><a href="Images/new-web-app.png" target="_blank"><img src="Images/new-web-app.png" alt="Creating a new Web Application project" style="max-width:100%;"></a></p>
<p><em>Creating a new Web Application project</em></p>
</li>
<li>
<p>In the "New ASP.NET Web Application" dialog, make sure <strong>MVC</strong> is selected. Then click <strong>OK</strong>.</p>
<p><a href="Images/new-mvc-project.png" target="_blank"><img src="Images/new-mvc-project.png" alt="Creating a new ASP.NET MVC project" style="max-width:100%;"></a></p>
<p><em>Creating a new ASP.NET MVC project</em></p>
</li>
<li>
<p>Take a moment to review the project structure in Solution Explorer. Among other things, there's a folder named "Controllers" that holds the project's MVC controllers, and a folder named "Views" that holds the project's views. You'll be working with assets in these folders and others as you implement the application.</p>
<p><a href="Images/project-structure.png" target="_blank"><img src="Images/project-structure.png" alt="The project shown in Solution Explorer" style="max-width:100%;"></a></p>
<p><em>The project shown in Solution Explorer</em></p>
</li>
<li>
<p>Use Visual Studio's <strong>Debug -&gt; Start Without Debugging</strong> command (or simply press <strong>Ctrl+F5</strong>) to launch the application in your browser. Here's how the application looks in its present state:</p>
<p><a href="Images/initial-application.png" target="_blank"><img src="Images/initial-application.png" alt="The initial application" style="max-width:100%;"></a></p>
<p><em>The initial application</em></p>
</li>
<li>
<p>Close the browser and return to Visual Studio. In Solution Explorer, right-click the <strong>Intellipix</strong> project and select <strong>Manage NuGet Packages...</strong>. Click <strong>Browse</strong>. Then type "imageresizer" (without quotation marks) into the search box and select the NuGet package named <strong>ImageResizer</strong>. Finally, click <strong>Install</strong> to install the latest stable version of the package. ImageResizer contains APIs that you will use to create image thumbnails from the images uploaded to the app. OK any changes and accept any licenses presented to you.</p>
<p><a href="Images/install-image-resizer.png" target="_blank"><img src="Images/install-image-resizer.png" alt="Installing ImageResizer" style="max-width:100%;"></a></p>
<p><em>Installing ImageResizer</em></p>
<p>NuGet is a free and open-source package manager for Microsoft development platforms. It provides access to thousands of libraries, or <em>packages</em>, containing code to perform a variety of tasks. It is integrated into Visual Studio, which makes it easy to add NuGet packages to your project and make a lot of things happen without writing a lot of code.</p>
</li>
<li>
<p>Repeat this process to add the NuGet package named <strong>WindowsAzure.Storage</strong> to the project. This package contains APIs for accessing Azure Storage from .NET applications. OK any changes and accept any licenses presented to you.</p>
<p><a href="Images/install-storage-package.png" target="_blank"><img src="Images/install-storage-package.png" alt="Installing WindowsAzure.Storage" style="max-width:100%;"></a></p>
<p><em>Installing WindowsAzure.Storage</em></p>
</li>
<li>
<p>Open <strong>Web.config</strong> and add the following statement to the <code>&lt;appSettings&gt;</code> section, replacing ACCOUNT_NAME with the name of the storage account you created in Exercise 1, and ACCOUNT_KEY with the access key you saved in Exercise 1, Step 10.</p>
<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">add</span> <span class="pl-e">key</span>=<span class="pl-s"><span class="pl-pds">"</span>StorageConnectionString<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>DefaultEndpointsProtocol=https;AccountName=ACCOUNT_NAME;AccountKey=ACCOUNT_KEY<span class="pl-pds">"</span></span> /&gt;</pre></div>
</li>
<li>
<p>Open the file named <strong>_Layout.cshtml</strong> in the project's "Views/Shared" folder. On line 19, change "Application name" to "Intellipix." Here is the edited line of code:</p>
<div class="highlight highlight-source-cs"><pre>@<span class="pl-en">Html.ActionLink</span>("Intellipix", "Index", "Home", new { area = <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span> }, new { @class = <span class="pl-s"><span class="pl-pds">"</span>navbar-brand<span class="pl-pds">"</span></span> })</pre></div>
<p>In an ASP.NET MVC project, <strong>_Layout.cshtml</strong> is a special view that serves as a template for other views. You typically define header and footer content that is common to all views in this file.</p>
</li>
<li>
<p>Right-click the project's "Models" folder and use the <strong>Add -&gt; Class...</strong> command to add a class file named <strong>BlobInfo.cs</strong> to the folder. Then replace the empty <code>BlobInfo</code> class with the following class definition:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">BlobInfo</span>
{
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">ImageUri</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">ThumbnailUri</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">Caption</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
}</pre></div>
</li>
<li>
<p>Open <strong>HomeController.cs</strong> in the project's "Controllers" folder and add the following <code>using</code> statements to the top of the file:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">ImageResizer</span>;
<span class="pl-k">using</span> <span class="pl-en">Intellipix.Models</span>;
<span class="pl-k">using</span> <span class="pl-en">Microsoft.WindowsAzure.Storage</span>;
<span class="pl-k">using</span> <span class="pl-en">Microsoft.WindowsAzure.Storage.Blob</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Configuration</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Threading.Tasks</span>;
<span class="pl-k">using</span> <span class="pl-en">System.IO</span>;</pre></div>
</li>
<li>
<p>Replace the <code>Index</code> method in <strong>HomeController.cs</strong> with the following implementation:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-en">ActionResult</span> <span class="pl-en">Index</span>()
{
    <span class="pl-c">// Pass a list of blob URIs in ViewBag</span>
    <span class="pl-en">CloudStorageAccount</span> <span class="pl-en">account</span> = CloudStorageAccount.Parse(ConfigurationManager.AppSettings[<span class="pl-s"><span class="pl-pds">"</span>StorageConnectionString<span class="pl-pds">"</span></span>]);
    <span class="pl-en">CloudBlobClient</span> <span class="pl-en">client</span> = account.CreateCloudBlobClient();
    <span class="pl-en">CloudBlobContainer</span> <span class="pl-en">container</span> = client.GetContainerReference(<span class="pl-s"><span class="pl-pds">"</span>photos<span class="pl-pds">"</span></span>);
    <span class="pl-en">List</span>&lt;<span class="pl-en">BlobInfo</span>&gt; <span class="pl-en">blobs</span> = <span class="pl-k">new</span> <span class="pl-en">List</span>&lt;BlobInfo&gt;();

    <span class="pl-k">foreach</span> (IListBlobItem item <span class="pl-k">in</span> container.ListBlobs())
    {
        <span class="pl-k">var</span> <span class="pl-en">blob </span>= item <span class="pl-en">as</span> <span class="pl-en">CloudBlockBlob</span>;

        <span class="pl-k">if</span> (blob != <span class="pl-c1">null</span>)
        {
            blobs.Add(<span class="pl-k">new</span> <span class="pl-en">BlobInfo</span>()
            {
                ImageUri = blob.Uri.ToString(),
                ThumbnailUri = blob.Uri.ToString().Replace(<span class="pl-s"><span class="pl-pds">"</span>/photos/<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>/thumbnails/<span class="pl-pds">"</span></span>)
            });
        }
    }

    ViewBag.Blobs = blobs.ToArray();
    <span class="pl-k">return</span> View();
}</pre></div>
<p>The new <code>Index</code> method enumerates the blobs in the "photos" container and passes an array of <code>BlobInfo</code> objects representing those blobs to the view through ASP.NET MVC's <code>ViewBag</code> property. In a moment, you will modify the view to enumerate these objects and display a collection of photo thumbnails. The classes used to access your storage account and enumerate the blobs — <a href="https://docs.microsoft.com/dotnet/api/microsoft.windowsazure.storage.cloudstorageaccount?view=azurestorage-8.1.3" rel="nofollow">CloudStorageAccount</a>, <a href="https://docs.microsoft.com/dotnet/api/microsoft.windowsazure.storage.blob.cloudblobclient?view=azurestorage-8.1.3" rel="nofollow">CloudBlobClient</a>, and <a href="https://docs.microsoft.com/dotnet/api/microsoft.windowsazure.storage.blob.cloudblobcontainer?view=azurestorage-8.1.3" rel="nofollow">CloudBlobContainer</a> — come from the WindowsAzure.Storage package you installed from NuGet.</p>
</li>
<li>
<p>Add the following method to the <code>HomeController</code> class in <strong>HomeController.cs</strong>:</p>
<div class="highlight highlight-source-cs"><pre>[HttpPost]
<span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">ActionResult</span>&gt; <span class="pl-en">Upload</span>(<span class="pl-en">HttpPostedFileBase</span> <span class="pl-smi">file</span>)
{
    <span class="pl-k">if</span> (file != <span class="pl-c1">null</span> &amp;&amp; file.ContentLength &gt; <span class="pl-c1">0</span>)
    {
        <span class="pl-c">// Make sure the user selected an image file</span>
        <span class="pl-k">if</span> (!file.ContentType.StartsWith(<span class="pl-s"><span class="pl-pds">"</span>image<span class="pl-pds">"</span></span>))
        {
            TempData[<span class="pl-s"><span class="pl-pds">"</span>Message<span class="pl-pds">"</span></span>] = <span class="pl-s"><span class="pl-pds">"</span>Only image files may be uploaded<span class="pl-pds">"</span></span>;
        }
        <span class="pl-k">else</span>
        {
            <span class="pl-k">try</span>
            {
                <span class="pl-c">// Save the original image in the "photos" container</span>
                <span class="pl-en">CloudStorageAccount</span> <span class="pl-en">account</span> = CloudStorageAccount.Parse(ConfigurationManager.AppSettings[<span class="pl-s"><span class="pl-pds">"</span>StorageConnectionString<span class="pl-pds">"</span></span>]);
                <span class="pl-en">CloudBlobClient</span> <span class="pl-en">client</span> = account.CreateCloudBlobClient();
                <span class="pl-en">CloudBlobContainer</span> <span class="pl-en">container</span> = client.GetContainerReference(<span class="pl-s"><span class="pl-pds">"</span>photos<span class="pl-pds">"</span></span>);
                <span class="pl-en">CloudBlockBlob</span> <span class="pl-en">photo</span> = container.GetBlockBlobReference(Path.GetFileName(file.FileName));
                <span class="pl-k">await</span> photo.UploadFromStreamAsync(file.InputStream);

                <span class="pl-c">// Generate a thumbnail and save it in the "thumbnails" container</span>
                <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">outputStream </span>= <span class="pl-k">new</span> <span class="pl-en">MemoryStream</span>())
                {
                    file.InputStream.Seek(<span class="pl-c1">0L</span>, SeekOrigin.Begin);
                    <span class="pl-k">var</span> <span class="pl-en">settings </span>= <span class="pl-k">new</span> <span class="pl-en">ResizeSettings</span> { MaxWidth = <span class="pl-c1">192</span> };
                    ImageBuilder.Current.Build(file.InputStream, outputStream, settings);
                    outputStream.Seek(<span class="pl-c1">0L</span>, SeekOrigin.Begin);
                    container = client.GetContainerReference(<span class="pl-s"><span class="pl-pds">"</span>thumbnails<span class="pl-pds">"</span></span>);
                    <span class="pl-en">CloudBlockBlob</span> <span class="pl-en">thumbnail</span> = container.GetBlockBlobReference(Path.GetFileName(file.FileName));
                    <span class="pl-k">await</span> thumbnail.UploadFromStreamAsync(outputStream);
                }
            }
            <span class="pl-k">catch</span> (Exception ex)
            {
                <span class="pl-c">// In case something goes wrong</span>
                TempData[<span class="pl-s"><span class="pl-pds">"</span>Message<span class="pl-pds">"</span></span>] = ex.Message;
            }
        }
    }

    <span class="pl-k">return</span> RedirectToAction(<span class="pl-s"><span class="pl-pds">"</span>Index<span class="pl-pds">"</span></span>);
}</pre></div>
<p>This is the method that's called when you upload a photo. It stores each uploaded image as a blob in the "photos" container, creates a thumbnail image from the original image using the ImageResizer package you installed in the previous lab, and stores the thumbnail image as a blob in the "thumbnails" container.</p>
</li>
<li>
<p>Open <strong>Index.cshmtl</strong> in the project's "Views/Home" folder and replace its contents with the following code and markup:</p>
<div class="highlight highlight-text-html-basic"><pre>@{
    ViewBag.Title = "Intellipix Home Page";
}

@using Intellipix.Models

&lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>container<span class="pl-pds">"</span></span> <span class="pl-e">style</span>=<span class="pl-s"><span class="pl-pds">"</span>padding-top: 24px<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>row<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>col-sm-8<span class="pl-pds">"</span></span>&gt;
            @using (Html.BeginForm("Upload", "Home", FormMethod.Post, new { enctype = "multipart/form-data" }))
            {
                &lt;<span class="pl-ent">input</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>file<span class="pl-pds">"</span></span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>file<span class="pl-pds">"</span></span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>upload<span class="pl-pds">"</span></span> <span class="pl-e">style</span>=<span class="pl-s"><span class="pl-pds">"</span>display: none<span class="pl-pds">"</span></span> <span class="pl-e">onchange</span>=<span class="pl-s"><span class="pl-pds">"</span>$('#submit').click();<span class="pl-pds">"</span></span> /&gt;
                &lt;<span class="pl-ent">input</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>button<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>Upload a Photo<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>btn btn-primary btn-lg<span class="pl-pds">"</span></span> <span class="pl-e">onclick</span>=<span class="pl-s"><span class="pl-pds">"</span>$('#upload').click();<span class="pl-pds">"</span></span> /&gt;
                &lt;<span class="pl-ent">input</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>submit<span class="pl-pds">"</span></span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>submit<span class="pl-pds">"</span></span> <span class="pl-e">style</span>=<span class="pl-s"><span class="pl-pds">"</span>display: none<span class="pl-pds">"</span></span> /&gt;
            }
        &lt;/<span class="pl-ent">div</span>&gt;
        &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>col-sm-4 pull-right<span class="pl-pds">"</span></span>&gt;
        &lt;/<span class="pl-ent">div</span>&gt;
    &lt;/<span class="pl-ent">div</span>&gt;

    &lt;<span class="pl-ent">hr</span> /&gt;

    &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>row<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>col-sm-12<span class="pl-pds">"</span></span>&gt;
            @foreach (BlobInfo blob in ViewBag.Blobs)
            {
                &lt;<span class="pl-ent">img</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>@blob.ThumbnailUri<span class="pl-pds">"</span></span> <span class="pl-e">width</span>=<span class="pl-s"><span class="pl-pds">"</span>192<span class="pl-pds">"</span></span> <span class="pl-e">title</span>=<span class="pl-s"><span class="pl-pds">"</span>@blob.Caption<span class="pl-pds">"</span></span> <span class="pl-e">style</span>=<span class="pl-s"><span class="pl-pds">"</span>padding-right: 16px; padding-bottom: 16px<span class="pl-pds">"</span></span> /&gt;
            }
        &lt;/<span class="pl-ent">div</span>&gt;
    &lt;/<span class="pl-ent">div</span>&gt;
&lt;/<span class="pl-ent">div</span>&gt;

@section scripts
{
    &lt;<span class="pl-ent">script</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>text/javascript<span class="pl-pds">"</span></span> <span class="pl-e">language</span>=<span class="pl-s"><span class="pl-pds">"</span>javascript<span class="pl-pds">"</span></span>&gt;<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-k">if</span> (<span class="pl-s"><span class="pl-pds">"</span>@TempData[<span class="pl-pds">"</span></span>Message<span class="pl-s"><span class="pl-pds">"</span>]<span class="pl-pds">"</span></span> <span class="pl-k">!==</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>) {</span>
<span class="pl-s1">            <span class="pl-en">alert</span>(<span class="pl-s"><span class="pl-pds">"</span>@TempData[<span class="pl-pds">"</span></span>Message<span class="pl-s"><span class="pl-pds">"</span>]<span class="pl-pds">"</span></span>);</span>
<span class="pl-s1">        }</span>
<span class="pl-s1">    </span><span class="pl-s1">&lt;</span>/<span class="pl-ent">script</span>&gt;
}</pre></div>
<p>The language used here is <a href="http://www.asp.net/web-pages/overview/getting-started/introducing-razor-syntax-c" rel="nofollow">Razor</a>, which lets you embed executable code in HTML markup. The <code>@foreach</code> statement in the middle of the file enumerates the <code>BlobInfo</code> objects passed from the controller in <code>ViewBag</code> and creates HTML <code>&lt;img&gt;</code> elements from them. The <code>src</code> property of each element is initialized with the URI of the blob containing the image thumbnail.</p>
</li>
<li>
<p>Save your changes and press <strong>Ctrl+F5</strong> to launch the application in your browser. Then click the <strong>Upload a Photo</strong> button and upload one of the images found in the "photos" folder of the <a href="https://a4r.blob.core.windows.net/public/cs-storage-resources.zip" rel="nofollow">resources that accompany this lab</a>. Confirm that a thumbnail version of the photo appears on the page:</p>
<p><a href="Images/one-photo-uploaded.png" target="_blank"><img src="Images/one-photo-uploaded.png" alt="Intellipix with one photo uploaded" style="max-width:100%;"></a></p>
<p><em>Intellipix with one photo uploaded</em></p>
</li>
<li>
<p>Upload a few more images from the "photos" folder. Confirm that they appear on the page, too:</p>
<p><a href="Images/three-photos-uploaded.png" target="_blank"><img src="Images/three-photos-uploaded.png" alt="Intellipix with three photos uploaded" style="max-width:100%;"></a></p>
<p><em>Intellipix with three photos uploaded</em></p>
</li>
<li>
<p>Do a <strong>View Source</strong> in your browser to view the source for the page. Find the <code>&lt;img&gt;</code> elements representing the image thumbnails. Observe that the URLs assigned to the images refer <strong>directly to blobs in blob storage</strong>. This is possible because you set the containers' <strong>Public access level</strong> to <strong>Blob</strong>, which makes the blobs inside them publicly accessible.</p>
<blockquote>
<p>What would happen if the containers were private? If you're not sure, try it and see. Temporaily change the "thumbnails" container's public access level to <strong>Private</strong> in the Azure Portal. Then refresh the Intellipix page in your browser and see what happens.</p>
</blockquote>
</li>
<li>
<p>Return to the Microsoft Azure Storage Explorer (or restart if it you didn't leave it running) and click the "photos" container under the storage account you created in Exercise 1. The number of blobs in the container should equal the number of photos you uploaded. Double-click one of the blobs to download it and see the image stored in the blob.</p>
<p><a href="Images/photos-container.png" target="_blank"><img src="Images/photos-container.png" alt="Contents of the &quot;photos&quot; container" style="max-width:100%;"></a></p>
<p><em>Contents of the "photos" container</em></p>
</li>
<li>
<p>Open the "thumbnails" container in Storage Explorer. How many blobs do you see there? Open one of the blobs to see what's inside. These are the thumbnail images generated from the image uploads.</p>
</li>
</ol>
<p>The app doesn't yet offer a way to view the original images that you uploaded. Ideally, clicking an image thumbnail should display the original image. Let's add that feature before proceeding further.</p>
<p><a name="Exercise4"></a></p>
<h2>Exercise 4: Add a lightbox for viewing photos</h2>
<p>In this exercise, you will use a free, open-source JavaScript library to add a lightbox viewer enabling users to see the original images that they uploaded (rather than just the image thumbnails). The files are provided for you in the resources that accompany this lab. All you have to do is integrate them into the project and make a minor modification to <strong>Index.cshtml</strong>.</p>
<ol>
<li>
<p>In Solution Explorer, right-click the project's "Scripts" folder and use the <strong>Add -&gt; Existing Item...</strong> command to import <strong>lightbox.js</strong> from the "scripts" folder in the lab resources.</p>
</li>
<li>
<p>Right-click the project's "Content" folder and use the <strong>Add -&gt; Existing Item...</strong> command to import <strong>lightbox.css</strong> from the "css" folder in the lab resources.</p>
</li>
<li>
<p>Right-click the Intellipix project in Solution Explorer and use the <strong>Add -&gt; New Folder</strong> command to add a folder named "Images" to the project.</p>
</li>
<li>
<p>Right-click the "Images" folder and use the <strong>Add -&gt; Existing Item...</strong> command to import the four images from the "images" folder in the lab resources.</p>
</li>
<li>
<p>Open <strong>BundleConfig.cs</strong> in the project's "App_Start" folder. Add the following statement to the <code>RegisterBundles</code> method in <strong>BundleConfig.cs</strong>:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-en">bundles.Add</span>(new <span class="pl-en">ScriptBundle</span>(<span class="pl-s"><span class="pl-pds">"</span>~/bundles/lightbox<span class="pl-pds">"</span></span>).<span class="pl-en">Include</span>(
          <span class="pl-s"><span class="pl-pds">"</span>~/Scripts/lightbox.js<span class="pl-pds">"</span></span>));</pre></div>
</li>
<li>
<p>In the same method, find the statement that creates a <code>StyleBundle</code> from "~/Content/css" and add <strong>lightbox.css</strong> to the list of style sheets in the bundle. Here is the modified statement:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-en">bundles.Add</span>(new <span class="pl-en">StyleBundle</span>(<span class="pl-s"><span class="pl-pds">"</span>~/Content/css<span class="pl-pds">"</span></span>).<span class="pl-en">Include</span>(
          <span class="pl-s"><span class="pl-pds">"</span>~/Content/bootstrap.css<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>~/Content/site.css<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>~/Content/lightbox.css<span class="pl-pds">"</span></span>));</pre></div>
</li>
<li>
<p>Open <strong>_Layout.cshtml</strong> in the project's "Views/Shared" folder and add the following statement just before the <code>@RenderSection</code> statement near the bottom:</p>
<div class="highlight highlight-source-cs"><pre>@<span class="pl-en">Scripts.Render</span>("~/bundles/lightbox")</pre></div>
</li>
<li>
<p>The final task is to incorporate the lightbox viewer into the home page. To do that, open <strong>Index.cshtml</strong> (it's in the project's "Views/Home" folder) and replace the <code>@foreach</code> loop with this one:</p>
<div class="highlight highlight-text-html-basic"><pre>@foreach (BlobInfo blob in ViewBag.Blobs)
{
    &lt;<span class="pl-ent">a</span> <span class="pl-e">href</span>=<span class="pl-s"><span class="pl-pds">"</span>@blob.ImageUri<span class="pl-pds">"</span></span> <span class="pl-e">rel</span>=<span class="pl-s"><span class="pl-pds">"</span>lightbox<span class="pl-pds">"</span></span> <span class="pl-e">title</span>=<span class="pl-s"><span class="pl-pds">"</span>@blob.Caption<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">img</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>@blob.ThumbnailUri<span class="pl-pds">"</span></span> <span class="pl-e">width</span>=<span class="pl-s"><span class="pl-pds">"</span>192<span class="pl-pds">"</span></span> <span class="pl-e">title</span>=<span class="pl-s"><span class="pl-pds">"</span>@blob.Caption<span class="pl-pds">"</span></span> <span class="pl-e">style</span>=<span class="pl-s"><span class="pl-pds">"</span>padding-right: 16px; padding-bottom: 16px<span class="pl-pds">"</span></span> /&gt;
    &lt;/<span class="pl-ent">a</span>&gt;
}</pre></div>
</li>
<li>
<p>Save your changes and press <strong>Ctrl+F5</strong> to launch the application in your browser. Then click one of the images you uploaded earlier. Confirm that a lightbox appears showing an enlarged view of the image.</p>
<p><a href="Images/lightbox-image.png" target="_blank"><img src="Images/lightbox-image.png" alt="An enlarged image" style="max-width:100%;"></a></p>
<p><em>An enlarged image</em></p>
</li>
<li>
<p>Click the <strong>X</strong> in the lower-right corner of the lightbox to dismiss it.</p>
</li>
</ol>
<p>Now you have a way to view the images you uploaded. The next step is to do more with those images.</p>
<p><a name="Exercise5"></a></p>
<h2>Exercise 5: Use Cognitive Services to generate metadata</h2>
<p>Now comes the fun part: using <a href="https://www.microsoft.com/cognitive-services/" rel="nofollow">Microsoft Cognitive Services</a> to generate captions and search keywords for the photos you upload. Cognitive Services is a set of intelligence APIs that you can call from your apps. Among the more than 25 APIs it offers are the <a href="https://www.microsoft.com/cognitive-services/en-us/computer-vision-api" rel="nofollow">Computer Vision API</a> for distilling actionable information from images, and the <a href="https://www.microsoft.com/cognitive-services/en-us/text-analytics-api" rel="nofollow">Text Analytics API</a> for extracting sentiments and other information from text (for example, Twitter feeds). These APIs make it possible to build smart apps that would have been impossible just a few short years ago. And they're available for you to begin using today.</p>
<p>In this exercise, you will use the Computer Vision API to generate a caption for each image that is uploaded, as well as keywords describing the contents of the image. You will store this data in metadata attached to each blob in the "photos" container.</p>
<ol>
<li>
<p>Begin by using the Azure Storage Explorer to delete the blobs in the "photos" container and the "thumbnails" container. (Do not delete the containers themselves.) This will allow you to start fresh with a new batch of images to process with the Computer Vision API.</p>
</li>
<li>
<p>In the Azure Portal, click <strong>+ New</strong>, followed by <strong>AI + Cognitive Services</strong> and <strong>Computer Vision API</strong>.</p>
<p><a href="Images/new-vision-api.png" target="_blank"><img src="Images/new-vision-api.png" alt="Creating a new Computer Vision API subscription" style="max-width:100%;"></a></p>
<p><em>Creating a new Computer Vision API subscription</em></p>
</li>
<li>
<p>Type "vision-api-key" into the <strong>Name</strong> box and select <strong>F0</strong> as the <strong>Pricing tier</strong>. Select the same <strong>Location</strong> that you selected for the storage account in <a href="#Exercise1">Exercise 1</a>. Under <strong>Resource group</strong>, select <strong>Use existing</strong> and select the "IntellipixResources" resource group. Check the <strong>I confirm</strong> box, and then click <strong>Create</strong>.</p>
<p><a href="Images/create-vision-api.png" target="_blank"><img src="Images/create-vision-api.png" alt="Subcribing to the Computer Vision API" style="max-width:100%;"></a></p>
<p><em>Subcribing to the Computer Vision API</em></p>
</li>
<li>
<p>Return to the blade for the "IntellipixResources" resource group and click the Computer Vision API subscription that you just created.</p>
<p><a href="Images/open-vision-api.png" target="_blank"><img src="Images/open-vision-api.png" alt="Opening the Computer Vision API subscription" style="max-width:100%;"></a></p>
<p><em>Opening the Computer Vision API subscription</em></p>
</li>
<li>
<p>Copy the URL under <strong>Endpoint</strong> into your favorite text editor so you can easily retrieve it in a moment. Then click <strong>Show access keys</strong>.</p>
<p><a href="Images/copy-vision-endpoint.png" target="_blank"><img src="Images/copy-vision-endpoint.png" alt="Viewing the access keys" style="max-width:100%;"></a></p>
<p><em>Viewing the access keys</em></p>
</li>
<li>
<p>Click the <strong>Copy</strong> button to the right of <strong>KEY 1</strong> to copy the access key to the clipboard.</p>
<p><a href="Images/copy-vision-key.png" target="_blank"><img src="Images/copy-vision-key.png" alt="Copying the access key" style="max-width:100%;"></a></p>
<p><em>Copying the access key</em></p>
</li>
<li>
<p>Return to Visual Studio. Open the <strong>Web.config</strong> file at the root of the project and add the following statements to the <code>&lt;appSettings&gt;</code> section of the file, replacing VISION_KEY with the key you saved in the previous step, and VISION_ENDPOINT with the URL you saved in the step before that:</p>
<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">add</span> <span class="pl-e">key</span>=<span class="pl-s"><span class="pl-pds">"</span>SubscriptionKey<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>VISION_KEY<span class="pl-pds">"</span></span> /&gt;
&lt;<span class="pl-ent">add</span> <span class="pl-e">key</span>=<span class="pl-s"><span class="pl-pds">"</span>VisionEndpoint<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>VISION_ENDPOINT<span class="pl-pds">"</span></span> /&gt;</pre></div>
</li>
<li>
<p>In Solution Explorer, right-click the project and use the <strong>Manage NuGet Packages...</strong> command to install a package named <strong>Microsoft.ProjectOxford.Vision</strong>. This package contains types for calling the Computer Vision API. As usual, approve any changes and licenses that are presented to you.</p>
<p><a href="Images/install-vision-package.png" target="_blank"><img src="Images/install-vision-package.png" alt="Installing Microsoft.ProjectOxford.Vision" style="max-width:100%;"></a></p>
<p><em>Installing Microsoft.ProjectOxford.Vision</em></p>
</li>
<li>
<p>Open <strong>HomeController.cs</strong> in the project's "Controllers" folder and add the following <code>using</code> statement at the top of the file:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">Microsoft.ProjectOxford.Vision</span>;</pre></div>
</li>
<li>
<p>Add the following statements to the <code>Upload</code> method, immediately after the block of code that begins with the comment "Generate a thumbnail and save it in the thumbnails container." This code passes the URL of the blob containing the image that was uploaded to the Computer Vision API, and requests that Computer Vision generate a description for the image. In addition to generating a description, the Computer Vision API also generates a list of keywords describing what it sees in the image. Your code stores the computer-generated description and the keywords in the blob's metadata so they can be retrieved later on.</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-c">// Submit the image to Azure's Computer Vision API</span>
<span class="pl-en">VisionServiceClient</span> <span class="pl-en">vision</span> = <span class="pl-k">new</span> <span class="pl-en">VisionServiceClient</span>(
    <span class="pl-en">ConfigurationManager.AppSettings</span>["SubscriptionKey"],
    ConfigurationManager.AppSettings["VisionEndpoint"]
);

<span class="pl-en">VisualFeature</span>[] <span class="pl-en">features</span> = <span class="pl-k">new</span> <span class="pl-en">VisualFeature</span>[] { VisualFeature.Description };
<span class="pl-k">var</span> <span class="pl-en">result </span>= <span class="pl-k">await</span> <span class="pl-en">vision.AnalyzeImageAsync</span>(photo.Uri.<span class="pl-en">ToString</span>(), features);

<span class="pl-c">// Record the image description and tags in blob metadata</span>
<span class="pl-en">photo.Metadata.Add</span>("Caption", result.Description.Captions[0].Text);

<span class="pl-k">for</span> (<span class="pl-k">int</span> <span class="pl-en">i</span> = <span class="pl-c1">0</span>; <span class="pl-en">i</span> &lt; result.Description.Tags.Length; <span class="pl-en">i</span>++)
{
    <span class="pl-k">string</span> <span class="pl-en">key</span> = String.Format(<span class="pl-s"><span class="pl-pds">"</span>Tag{0}<span class="pl-pds">"</span></span>, i);
    photo.Metadata.Add(key, result.Description.Tags[i]);
}

<span class="pl-k">await</span> <span class="pl-en">photo.SetMetadataAsync</span>();</pre></div>
</li>
<li>
<p>Replace the <code>foreach</code> block in the <code>Index</code> method with the following statements:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">foreach</span> (<span class="pl-en">IListBlobItem</span> item in container.<span class="pl-en">ListBlobs</span>())
{
    <span class="pl-k">var</span> <span class="pl-en">blob </span>= item <span class="pl-en">as</span> <span class="pl-en">CloudBlockBlob</span>;

    <span class="pl-k">if</span> (blob != <span class="pl-c1">null</span>)
    {
        blob.FetchAttributes(); <span class="pl-c">// Get blob metadata</span>
        <span class="pl-k">var</span> <span class="pl-en">caption </span>= blob.Metadata.ContainsKey(<span class="pl-s"><span class="pl-pds">"</span>Caption<span class="pl-pds">"</span></span>) ? blob.Metadata[<span class="pl-s"><span class="pl-pds">"</span>Caption<span class="pl-pds">"</span></span>] : blob.Name;

        blobs.Add(<span class="pl-k">new</span> <span class="pl-en">BlobInfo</span>()
        {
            ImageUri = blob.Uri.ToString(),
            ThumbnailUri = blob.Uri.ToString().Replace(<span class="pl-s"><span class="pl-pds">"</span>/photos/<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>/thumbnails/<span class="pl-pds">"</span></span>),
            Caption = caption
        });
    }
}</pre></div>
<p>The modified <code>foreach</code> block calls <a href="https://msdn.microsoft.com/library/microsoft.windowsazure.storage.blob.cloudblockblob.fetchattributes(v=azure.10).aspx" rel="nofollow">CloudBlockBlob.FetchAttributes</a> to fetch the metadata for the blob. Then it extracts the computer-generated description from the metadata and adds it to the <code>BlobInfo</code> object passed to the view.</p>
</li>
<li>
<p>Save your changes and press <strong>Ctrl+F5</strong> to launch the application in your browser. Upload a few images from the "photos" folder in the lab resources.</p>
</li>
<li>
<p>Hover the cursor over one of the thumbnails. Confirm that a tooltip window appears containing the computer-generated caption for the image.</p>
<p><a href="Images/thumbnail-with-tooltip.png" target="_blank"><img src="Images/thumbnail-with-tooltip.png" alt="The computer-generated caption" style="max-width:100%;"></a></p>
<p><em>The computer-generated caption</em></p>
</li>
<li>
<p>Click one of the thumbnails to display the original image in a lightbox. Confirm that the computer-generated caption appears at the bottom of the lightbox. Then dismiss the lightbox.</p>
<p><a href="Images/lightbox-with-caption.png" target="_blank"><img src="Images/lightbox-with-caption.png" alt="Lightbox with computer-generated caption" style="max-width:100%;"></a></p>
<p><em>Lightbox with computer-generated caption</em></p>
</li>
<li>
<p>Want to see where the metadata generated by the Computer Vision API is stored? Use the Azure Storage Explorer to open the "photos" container. Right-click any of the blobs in the container and select <strong>Properties</strong>. In the ensuing dialog, you'll see the metadata attached to the blob. Each metadata item is a key-value pair. The computer-generated image description is stored in the item named "Caption," while the metadata items named "Tag0," "Tag1," and so on hold the additional keywords created for the image. When you're finished, click <strong>Cancel</strong> to close the dialog.</p>
<p><a href="Images/blob-metadata.png" target="_blank"><img src="Images/blob-metadata.png" alt="Blob metadata" style="max-width:100%;"></a></p>
<p><em>Blob metadata</em></p>
</li>
</ol>
<p>In the next exercise, you'll put the extra keywords to work by adding search to the app.</p>
<p><a name="Exercise6"></a></p>
<h2>Exercise 6: Add search to the app</h2>
<p>In this exercise, you will add a search box to the home page enabling users to do keyword searches on the images that they have uploaded. The keywords are the ones generated by the Computer Vision API and stored in blob metadata.</p>
<ol>
<li>
<p>Open <strong>Index.cshtml</strong> in the project's "Views/Home folder" and add the following statements to the empty <code>&lt;div&gt;</code> element with the <code>class="col-sm-4 pull-right"</code> attribute:</p>
<div class="highlight highlight-text-html-basic"><pre>@using (Html.BeginForm("Search", "Home", FormMethod.Post, new { enctype = "multipart/form-data", @class = "navbar-form" }))
{
    &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>input-group<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">input</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>form-control<span class="pl-pds">"</span></span> <span class="pl-e">placeholder</span>=<span class="pl-s"><span class="pl-pds">"</span>Search photos<span class="pl-pds">"</span></span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>term<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>@ViewBag.Search<span class="pl-pds">"</span></span> <span class="pl-e">style</span>=<span class="pl-s"><span class="pl-pds">"</span>max-width: 800px<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">span</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>input-group-btn<span class="pl-pds">"</span></span>&gt;
            &lt;<span class="pl-ent">button</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>btn btn-primary<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>submit<span class="pl-pds">"</span></span>&gt;
                &lt;<span class="pl-ent">i</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>glyphicon glyphicon-search<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">i</span>&gt;
            &lt;/<span class="pl-ent">button</span>&gt;
        &lt;/<span class="pl-ent">span</span>&gt;
    &lt;/<span class="pl-ent">div</span>&gt;
}</pre></div>
<p>This code and markup adds a search box and a <strong>Search</strong> button to the home page.</p>
</li>
<li>
<p>Open <strong>HomeController.cs</strong> in the project's "Controllers" folder and add the following method to the <code>HomeController</code> class:</p>
<div class="highlight highlight-source-cs"><pre>[HttpPost]
<span class="pl-k">public</span> <span class="pl-en">ActionResult</span> <span class="pl-en">Search</span>(<span class="pl-k">string</span> <span class="pl-smi">term</span>)
{
    <span class="pl-k">return</span> RedirectToAction(<span class="pl-s"><span class="pl-pds">"</span>Index<span class="pl-pds">"</span></span>, new { id = term });
}</pre></div>
<p>This is the method that's called when the user clicks the <strong>Search</strong> button added in the previous step. It refreshes the page and includes a search parameter in the URL.</p>
</li>
<li>
<p>Replace the <code>Index</code> method with the following implementation:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-en">ActionResult</span> <span class="pl-en">Index</span>(<span class="pl-k">string</span> <span class="pl-smi">id</span>)
{
    <span class="pl-c">// Pass a list of blob URIs and captions in ViewBag</span>
    <span class="pl-en">CloudStorageAccount</span> <span class="pl-en">account</span> = CloudStorageAccount.Parse(ConfigurationManager.AppSettings[<span class="pl-s"><span class="pl-pds">"</span>StorageConnectionString<span class="pl-pds">"</span></span>]);
    <span class="pl-en">CloudBlobClient</span> <span class="pl-en">client</span> = account.CreateCloudBlobClient();
    <span class="pl-en">CloudBlobContainer</span> <span class="pl-en">container</span> = client.GetContainerReference(<span class="pl-s"><span class="pl-pds">"</span>photos<span class="pl-pds">"</span></span>);
    <span class="pl-en">List</span>&lt;<span class="pl-en">BlobInfo</span>&gt; <span class="pl-en">blobs</span> = <span class="pl-k">new</span> <span class="pl-en">List</span>&lt;BlobInfo&gt;();

    <span class="pl-k">foreach</span> (IListBlobItem item <span class="pl-k">in</span> container.ListBlobs())
    {
        <span class="pl-k">var</span> <span class="pl-en">blob </span>= item <span class="pl-en">as</span> <span class="pl-en">CloudBlockBlob</span>;

        <span class="pl-k">if</span> (blob != <span class="pl-c1">null</span>)
        {
            blob.FetchAttributes(); <span class="pl-c">// Get blob metadata</span>

            <span class="pl-k">if</span> (String.IsNullOrEmpty(id) || HasMatchingMetadata(blob, id))
            {
                <span class="pl-k">var</span> <span class="pl-en">caption </span>= blob.Metadata.ContainsKey(<span class="pl-s"><span class="pl-pds">"</span>Caption<span class="pl-pds">"</span></span>) ? blob.Metadata[<span class="pl-s"><span class="pl-pds">"</span>Caption<span class="pl-pds">"</span></span>] : blob.Name;

                blobs.Add(<span class="pl-k">new</span> <span class="pl-en">BlobInfo</span>()
                {
                    ImageUri = blob.Uri.ToString(),
                    ThumbnailUri = blob.Uri.ToString().Replace(<span class="pl-s"><span class="pl-pds">"</span>/photos/<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>/thumbnails/<span class="pl-pds">"</span></span>),
                    Caption = caption
                });
            }
        }
    }

    ViewBag.Blobs = blobs.ToArray();
    ViewBag.Search = id; <span class="pl-c">// Prevent search box from losing its content</span>
    <span class="pl-k">return</span> View();
}</pre></div>
<p>Observe that the <code>Index</code> method now accepts a parameter ("id") that contains the value the user typed into the search box. An empty or missing "id" parameter indicates that all the photos should be displayed.</p>
</li>
<li>
<p>Add the following helper method to the <code>HomeController</code> class:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">private</span> <span class="pl-k">bool </span>HasMatchingMetadata(CloudBlockBlob blob, <span class="pl-k">string </span>term)
{
    <span class="pl-k">foreach</span> (var item <span class="pl-k">in</span> blob.Metadata)
    {
        <span class="pl-k">if</span> (item.Key.StartsWith(<span class="pl-s"><span class="pl-pds">"</span>Tag<span class="pl-pds">"</span></span>) &amp;&amp; item.Value.Equals(term, StringComparison.InvariantCultureIgnoreCase))
            <span class="pl-k">return</span> <span class="pl-c1">true</span>;
    }

    <span class="pl-k">return</span> <span class="pl-c1">false</span>;
}</pre></div>
<p>This method is called by the <code>Index</code> method to determine whether the metadata keywords attached to a given image blob contain the search term that the user entered.</p>
</li>
<li>
<p>Launch the application again and upload several photos. <strong>Feel free to upload photos of your own</strong>, not just the ones provided with the lab.</p>
</li>
<li>
<p>Type a keyword such as "river" into the search box. Then click the <strong>Search</strong> button.</p>
<p><a href="Images/enter-search-term.png" target="_blank"><img src="Images/enter-search-term.png" alt="Performing a search" style="max-width:100%;"></a></p>
<p><em>Performing a search</em></p>
</li>
<li>
<p>Search results will vary depending on what you typed and what images you uploaded. But the result should be a filtered list of images — images whose metadata keywords include all or part of the keyword that you typed.</p>
<p><a href="Images/search-results.png" target="_blank"><img src="Images/search-results.png" alt="Search results" style="max-width:100%;"></a></p>
<p><em>Search results</em></p>
</li>
<li>
<p>Click the browser's back button to display all of the images again.</p>
</li>
</ol>
<p>You're almost finished, but the final and most important step remains. It is time to deploy the app to the cloud.</p>
<p><a name="Exercise7"></a></p>
<h2>Exercise 7: Deploy the app to Azure</h2>
<p>In this exercise, you will deploy the app to Azure from Visual Studio. You will even allow Visual Studio to create an Azure Web App for you, preventing you from having to go into the Azure Portal and create it separately.</p>
<ol>
<li>
<p>Right-click the project in Solution Explorer and select <strong>Publish...</strong> from the context menu. Make sure <strong>Microsoft Azure App Service</strong> and <strong>Create New</strong> are selected, and then click the <strong>Publish</strong> button.</p>
<p><a href="Images/publish-1.png" target="_blank"><img src="Images/publish-1.png" alt="Publishing the app" style="max-width:100%;"></a></p>
<p><em>Publishing the app</em></p>
</li>
<li>
<p>In the ensuing dialog, select the "IntellipixResources" resource group under <strong>Resource Group</strong>. Click the <strong>New...</strong> button next to "App Service Plan" and create a new App Service Plan in the same location you selected for the storage account in <a href="#Exercise1">Exercise 1</a>, accepting the defaults everywhere else. Finish up by clicking the <strong>Create</strong> button.</p>
<p><a href="Images/publish-2.png" target="_blank"><img src="Images/publish-2.png" alt="Creating an Azure Web App" style="max-width:100%;"></a></p>
<p><em>Creating an Azure Web App</em></p>
</li>
<li>
<p>After a few moments, the app will appear in a browser window. Note the URL in the address bar. The app is no longer running locally; it's on the Web, where it's reachable by everyone.</p>
<p><a href="Images/vs-intellipix.png" target="_blank"><img src="Images/vs-intellipix.png" alt="The finished product!" style="max-width:100%;"></a></p>
<p><em>The finished product!</em></p>
</li>
</ol>
<p>If you make changes to the app and want to push the changes out to the Web, simply go through the publish process again. Of course, you can still test your changes locally before publishing to the Web.</p>
<p><a name="Summary"></a></p>
<h2>Summary</h2>
<p>When you're finished using the site, you should delete the resource group containing it. Deleting the resource group deletes all of the resources inside it (including the storage account, the blobs uploaded to it, and the App Service), removes all traces of this lab from your account, and prevents any further charges from being incurred for it. To delete the resource group, simply open the resource-group blade in the portal and click <strong>Delete resource group</strong> at the top of the blade. You will be asked to type the resource group's name to confirm that you want to delete it, because once deleted, a resource group can't be recovered.</p>
<p>There is much more that you could do to develop Intellipix and to leverage Azure even further. For example, you could add support for authenticating users and deleting photos, and rather than force the user to wait for Cognitive Services to process a photo following an upload, you could use <a href="https://azure.microsoft.com/en-us/services/functions/" rel="nofollow">Azure Functions</a> to call the Computer Vision API asynchronously each time an image is added to blob storage. You could even use Cognitive Services to detect faces in the photos and analyze the emotions depicted by those faces. With the cloud as your platform, the sky is the limit (pun intended).</p>
<hr>
<p>Copyright 2017 Microsoft Corporation. All rights reserved. Except where otherwise noted, these materials are licensed under the terms of the MIT License. You may use them according to the license as is most appropriate for your project. The terms of this license can be found at <a href="https://opensource.org/licenses/MIT" rel="nofollow">https://opensource.org/licenses/MIT</a>.</p>
</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->
